<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Análise de Investimentos - Guga</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { overflow-x: hidden; font-family: 'Inter', sans-serif; }
    input:focus, select:focus { 
      border-color: #00d4ff !important; 
      box-shadow: 0 0 0 1px #00d4ff, 0 0 40px rgba(0,212,255,0.2) !important; 
      outline: none;
    }
    button:not(:disabled):hover { 
      transform: translateY(-2px); 
      filter: brightness(1.1); 
    }
    button:not(:disabled):active { 
      transform: translateY(0); 
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useCallback, useRef, useEffect } = React;
    const { LineChart, Line, AreaChart, Area, PieChart, Pie, Cell, XAxis, YAxis, Tooltip, Legend, ResponsiveContainer, CartesianGrid } = Recharts;

    // ─── CONSTANTS ──────────────────────────────────────────────────────────────
    const CLASSES = [
      { key:"rf_cdi",       label:"RF CDI",                      group:"Brasil",        color:"#10b981" },
      { key:"multimercado", label:"MultiMercado",                 group:"Brasil",        color:"#06b6d4" },
      { key:"fii",          label:"FII",                          group:"Brasil",        color:"#f59e0b" },
      { key:"rf_inf",       label:"RF Inflação",                  group:"Brasil",        color:"#84cc16" },
      { key:"td_inf",       label:"TD Inflação",                  group:"Brasil",        color:"#22c55e" },
      { key:"td_pre",       label:"TD Prefixado",                 group:"Brasil",        color:"#14b8a6" },
      { key:"br_stocks",    label:"BR Stocks",                    group:"Brasil",        color:"#ef4444" },
      { key:"alt_br",       label:"Ativos Reais e Alternativos", group:"Brasil",        color:"#eab308" },
      { key:"btc",          label:"BTC (Digital Gold)",           group:"Cripto",        color:"#f59e0b" },
      { key:"cripto_ex",    label:"Cripto ex BTC",                group:"Cripto",        color:"#fb923c" },
      { key:"sp500",        label:"S&P 500",                      group:"Internacional", color:"#8b5cf6" },
      { key:"tech",         label:"Tech (Nasdaq)",                group:"Internacional", color:"#a855f7" },
      { key:"tbills",       label:"T-Bills/Pré USD",              group:"Internacional", color:"#64748b" },
      { key:"bonds",        label:"Bonds USD",                    group:"Internacional", color:"#475569" },
      { key:"us_stocks",    label:"US Stocks",                    group:"Internacional", color:"#6366f1" },
      { key:"energy",       label:"Energy",                       group:"Internacional", color:"#dc2626" },
      { key:"alt_intl",     label:"Ativos Reais e Alternativos", group:"Internacional", color:"#f97316" },
    ];
    const GROUPS = ["Brasil","Cripto","Internacional"];
    const GROUP_COLORS = { Brasil:"#00d4ff", Cripto:"#f59e0b", Internacional:"#a855f7" };
    const TARGET = { rf_cdi:10,multimercado:7,fii:6,rf_inf:10,td_inf:7,td_pre:5,br_stocks:5,alt_br:0,btc:7,cripto_ex:3,sp500:10,tech:10,tbills:2,bonds:8,us_stocks:3,energy:7,alt_intl:0 };

    const CRIPTO_POSITIONS = [
      { id:"steth",  label:"Lido stETH", symbol:"stETH",  qty:1.4999,    color:"#06b6d4", classKey:"cripto_ex" },
      { id:"sol",    label:"Solana",      symbol:"SOL",     qty:8.15784,   color:"#8b5cf6", classKey:"cripto_ex" },
      { id:"hbar",   label:"Hedera",      symbol:"HBAR",    qty:2170.68,   color:"#14b8a6", classKey:"cripto_ex" },
      { id:"eth",    label:"Ethereum",    symbol:"ETH",     qty:0.0008786, color:"#0ea5e9", classKey:"cripto_ex" },
      { id:"yieldx", label:"YIELDX",     symbol:"YIELDX",  qty:199.27,    color:"#10b981", classKey:"cripto_ex" },
      { id:"xpt",    label:"XPToken",     symbol:"XPT",     qty:0.001,     color:"#ef4444", classKey:"cripto_ex" },
    ];

    const FALLBACK_CRIPTO = {
      steth:  { valueBRL: 15805.84, brlPerUnit: 15805.84/1.4999 },
      sol:    { valueBRL: 3746.84,  brlPerUnit: 3746.84/8.15784  },
      hbar:   { valueBRL: 1145.57,  brlPerUnit: 1145.57/2170.68  },
      eth:    { valueBRL: 9.25,     brlPerUnit: 9.25/0.0008786   },
      yieldx: { valueBRL: 0.02,     brlPerUnit: 0.02/199.27      },
      xpt:    { valueBRL: null,     brlPerUnit: null              },
      usdBrl: 5.20,
      fonte: "Fallback: Ledger 15/02/2026",
      ts: new Date("2026-02-15").getTime(),
      isFallback: true,
    };

    const BROKER_POSITIONS = [
      { id:"borr", label:"Borr Drilling",       symbol:"BORR", qty:763, color:"#ef4444", classKey:"energy"    },
      { id:"ne",   label:"Noble Corp",          symbol:"NE",   qty:13,  color:"#dc2626", classKey:"energy"    },
      { id:"val",  label:"Valaris",             symbol:"VAL",  qty:7,   color:"#fb923c", classKey:"energy"    },
      { id:"euhy", label:"iSh EUR HY Corp Bnd", symbol:"EUHY", qty:22,  color:"#64748b", classKey:"bonds"     },
      { id:"qqq",  label:"Invesco QQQ",         symbol:"QQQ",  qty:3,   color:"#a855f7", classKey:"tech"      },
      { id:"schd", label:"Schwab SCHD",         symbol:"SCHD", qty:57,  color:"#6366f1", classKey:"us_stocks" },
      { id:"tmf",  label:"TMF 3x Treasury",     symbol:"TMF",  qty:30,  color:"#64748b", classKey:"bonds"     },
      { id:"urnm", label:"Sprott Uranium",      symbol:"URNM", qty:43,  color:"#f97316", classKey:"energy"    },
    ];

    const BASE_MAP = {
      "rf cdi":"rf_cdi","cdi":"rf_cdi","caixa":"rf_cdi","pos fixado":"rf_cdi","selic":"rf_cdi","liquidez":"rf_cdi","cdb":"rf_cdi",
      "multimercado":"multimercado","multi mercado":"multimercado","macro":"multimercado","hedge":"multimercado",
      "fii":"fii","fundos imobiliarios":"fii","fundos imobiliários":"fii","fiis":"fii","ifix":"fii","fundo imobiliario":"fii",
      "rf inf":"rf_inf","rf inflacao":"rf_inf","cri":"rf_inf","lci":"rf_inf","lca":"rf_inf","cra":"rf_inf","debenture":"rf_inf","debênture":"rf_inf","incentivada":"rf_inf",
      "td inf":"td_inf","td inflacao":"td_inf","tesouro ipca":"td_inf","ipca+":"td_inf","ntnb":"td_inf","ima-b":"td_inf",
      "td pre":"td_pre","td prefixado":"td_pre","tesouro prefixado":"td_pre","ltn":"td_pre","prefixado":"td_pre",
      "br stocks":"br_stocks","acoes br":"br_stocks","bolsa":"br_stocks","ibovespa":"br_stocks","ibov":"br_stocks","acoes":"br_stocks","ações":"br_stocks",
      "alt br":"alt_br","alternativos br":"alt_br","fidc":"alt_br","fiagro":"alt_br","infra":"alt_br","infraestrutura":"alt_br","private equity":"alt_br","venture capital br":"alt_br",
      "btc":"btc","bitcoin":"btc",
      "cripto ex btc":"cripto_ex","altcoin":"cripto_ex","ethereum":"cripto_ex","solana":"cripto_ex","cripto":"cripto_ex","crypto":"cripto_ex",
      "s&p":"sp500","sp500":"sp500","spy":"sp500","ivvb11":"sp500","s&p 500":"sp500",
      "tech":"tech","nasdaq":"tech","tecnologia":"tech","qqq":"tech","fomo11":"tech",
      "t-bills":"tbills","tbills":"tbills","t bills":"tbills",
      "bonds":"bonds","bonds usd":"bonds","treasuries":"bonds","treasury":"bonds",
      "us stocks":"us_stocks","acwi":"us_stocks","schd":"us_stocks",
      "energy":"energy","energia":"energy","petroleo":"energy","petróleo":"energy","oil":"energy","xle":"energy","urnm":"energy","uranium":"energy",
      "alt intl":"alt_intl","alternativos":"alt_intl","commodities":"alt_intl","reit":"alt_intl","reits":"alt_intl","venture capital":"alt_intl","private equity intl":"alt_intl","infrastructure":"alt_intl",
    };

    // ─── HELPERS ────────────────────────────────────────────────────────────────
    function tryMapKey(label, customMap) {
      const l = label.toLowerCase().trim();
      if (customMap[l]) return customMap[l];
      for (const [p,k] of Object.entries(BASE_MAP)) if (l.includes(p)) return k;
      return "";
    }

    function parseCSV(text) {
      const res = {};
      for (const line of text.split("\n").filter(l=>l.trim())) {
        const parts = line.split(/[,;\t]/).map(p=>p.trim().replace(/"/g,""));
        if (parts.length>=2) {
          const label=parts[0], val=parseFloat(parts[parts.length-1].replace("%","").replace(",","."));
          if (label && !isNaN(val) && val>0) res[label]=val;
        }
      }
      return res;
    }

    const fmt=(n,d=0)=>n===undefined||n===null||isNaN(n)?"—":`R$ ${Number(n).toLocaleString("pt-BR",{minimumFractionDigits:d,maximumFractionDigits:d})}`;
    const fmtUSD=(n,d=2)=>n===undefined||n===null||isNaN(n)?"—":`$ ${Number(n).toLocaleString("en-US",{minimumFractionDigits:d,maximumFractionDigits:d})}`;
    const pct=(n)=>n===undefined?0:Number(n).toFixed(1)+"%";

    // Storage adapter for localStorage
    const storage = {
      get: (key) => {
        try {
          const val = localStorage.getItem(key);
          return val ? { value: val } : null;
        } catch { return null; }
      },
      set: (key, value) => {
        try {
          localStorage.setItem(key, value);
          return { key, value };
        } catch { return null; }
      }
    };

    // ─── MAIN APP ───────────────────────────────────────────────────────────────
    function App() {
      const [tab,setTab]=useState("carteira");
      const [mode,setMode]=useState("target");
      const [customAlloc,setCustomAlloc]=useState({...TARGET});
      const [patrimonio,setPatrimonio]=useState("");
      const [customMap,setCustomMap]=useState({});
      const [history,setHistory]=useState([]);
      const [expandedH,setExpandedH]=useState(null);
      const [expandedClass,setExpandedClass]=useState({});
      const [showPie,setShowPie]=useState(false);
      const [permTab,setPermTab]=useState("cripto");
      const [fidcItems,setFidcItems]=useState([]);
      const [ativosReaisItems,setAtivosReaisItems]=useState([]);
      const [startupsItems,setStartupsItems]=useState([]);
      const [schwabItems,setSchwabItems]=useState([]);
      const [editingManual,setEditingManual]=useState({type:"",name:"",valueBRL:"",classKey:""});
      const [editingSchwab,setEditingSchwab]=useState({symbol:"",qty:"",classKey:""});
      const [saveMsg,setSaveMsg]=useState("");

      useEffect(()=>{
        try{const r=storage.get("asset_mappings");if(r)setCustomMap(JSON.parse(r.value));}catch{}
        try{const r=storage.get("portfolio_history");if(r){const h=JSON.parse(r.value);setHistory(h);if(h.length>0){setCustomAlloc({...h[0].alloc});setMode("custom");}}}catch{}
        try{const r=storage.get("fidc_items");if(r)setFidcItems(JSON.parse(r.value));}catch{}
        try{const r=storage.get("ativos_reais_items");if(r)setAtivosReaisItems(JSON.parse(r.value));}catch{}
        try{const r=storage.get("startups_items");if(r)setStartupsItems(JSON.parse(r.value));}catch{}
        try{
          const r=storage.get("schwab_items");
          if(r)setSchwabItems(JSON.parse(r.value));
          else setSchwabItems(BROKER_POSITIONS.map(p=>({...p,id:p.id||Date.now().toString()+Math.random()})));
        }catch{setSchwabItems(BROKER_POSITIONS.map(p=>({...p,id:p.id||Date.now().toString()+Math.random()})));}
      },[]);

      const persist=async(map,hist)=>{
        if(map!==undefined)storage.set("asset_mappings",JSON.stringify(map));
        if(hist!==undefined)storage.set("portfolio_history",JSON.stringify(hist));
      };

      const persistManual=(type,items)=>{
        const key=type==="fidc"?"fidc_items":type==="ativos"?"ativos_reais_items":"startups_items";
        storage.set(key,JSON.stringify(items));
      };

      const persistSchwab=(items)=>{
        storage.set("schwab_items",JSON.stringify(items));
      };

      const saveCarteira=useCallback(async()=>{
        try{await persist(customMap,history);setSaveMsg("✓ Salvo");setTimeout(()=>setSaveMsg(""),2000);}
        catch{setSaveMsg("✕ Erro");}
      },[customMap,history]);

      function calcCriptoPortfolio(){
        const rate=FALLBACK_CRIPTO.usdBrl;
        return CRIPTO_POSITIONS.map(pos=>{
          const fb=FALLBACK_CRIPTO[pos.id];
          let valueBRL=null,priceUSD=null,valueUSD=null;
          if(fb&&fb.brlPerUnit!=null){valueBRL=pos.qty*fb.brlPerUnit;priceUSD=fb.brlPerUnit/rate;valueUSD=valueBRL/rate;}
          return {...pos,priceUSD,valueUSD,valueBRL,isFallback:true};
        });
      }

      function calcBrokerPortfolio(){
        return schwabItems.map(pos=>({...pos,priceUSD:null,valueUSD:null,valueBRL:null}));
      }

      function getPermanentBrlValues(){
        const brl={};
        calcCriptoPortfolio().forEach(p=>{if(p.valueBRL!=null) brl[p.classKey]=(brl[p.classKey]||0)+p.valueBRL;});
        [...fidcItems,...ativosReaisItems,...startupsItems].forEach(item=>{
          if(item.classKey&&item.valueBRL>0) brl[item.classKey]=(brl[item.classKey]||0)+item.valueBRL;
        });
        return brl;
      }

      const reclassifyAsset=useCallback(async(rawName, oldClassKey, newClassKey)=>{
        if(!history.length||!newClassKey||newClassKey===oldClassKey) return;
        const entry={...history[0],mappings:[...history[0].mappings]};
        const rate=entry.usdRate||5.22;
        const idx=entry.mappings.findIndex(m=>m.raw===rawName);
        if(idx===-1) return;
        const mapping={...entry.mappings[idx],classKey:newClassKey};
        entry.mappings[idx]=mapping;
        const brl=mapping.currency==="USD"?mapping.rawVal*rate:mapping.rawVal;
        const newBrlValues={...entry.brlValues};
        newBrlValues[oldClassKey]=Math.max(0,(newBrlValues[oldClassKey]||0)-brl);
        newBrlValues[newClassKey]=(newBrlValues[newClassKey]||0)+brl;
        const totalBRL=Object.values(newBrlValues).reduce((a,b)=>a+b,0);
        const newAlloc={};
        CLASSES.forEach(c=>{newAlloc[c.key]=totalBRL>0?+((newBrlValues[c.key]||0)/totalBRL*100).toFixed(2):0;});
        entry.brlValues=newBrlValues;entry.alloc=newAlloc;
        const newHist=[entry,...history.slice(1)];
        const lkey=rawName.toLowerCase().trim();
        const updMap={...customMap,[lkey]:newClassKey};
        setHistory(newHist);setCustomMap(updMap);setCustomAlloc(newAlloc);
        await persist(updMap,newHist);
      },[history,customMap]);

      const addManualItem=useCallback((type)=>{
        const {name,valueBRL,classKey}=editingManual;
        if(!name||!valueBRL||!classKey) return;
        const val=parseFloat(valueBRL);
        if(isNaN(val)||val<=0) return;
        const item={id:Date.now().toString(),name,valueBRL:val,classKey};
        if(type==="fidc"){const n=[...fidcItems,item];setFidcItems(n);persistManual("fidc",n);}
        else if(type==="ativos"){const n=[...ativosReaisItems,item];setAtivosReaisItems(n);persistManual("ativos",n);}
        else if(type==="startups"){const n=[...startupsItems,item];setStartupsItems(n);persistManual("startups",n);}
        setEditingManual({type:"",name:"",valueBRL:"",classKey:""});
      },[editingManual,fidcItems,ativosReaisItems,startupsItems]);

      const removeManualItem=useCallback((type,id)=>{
        if(type==="fidc"){const n=fidcItems.filter(i=>i.id!==id);setFidcItems(n);persistManual("fidc",n);}
        else if(type==="ativos"){const n=ativosReaisItems.filter(i=>i.id!==id);setAtivosReaisItems(n);persistManual("ativos",n);}
        else if(type==="startups"){const n=startupsItems.filter(i=>i.id!==id);setStartupsItems(n);persistManual("startups",n);}
      },[fidcItems,ativosReaisItems,startupsItems]);

      const updateManualItem=useCallback((type,id,field,val)=>{
        if(type==="fidc"){const n=fidcItems.map(i=>i.id===id?{...i,[field]:field==="valueBRL"?parseFloat(val)||0:val}:i);setFidcItems(n);persistManual("fidc",n);}
        else if(type==="ativos"){const n=ativosReaisItems.map(i=>i.id===id?{...i,[field]:field==="valueBRL"?parseFloat(val)||0:val}:i);setAtivosReaisItems(n);persistManual("ativos",n);}
        else if(type==="startups"){const n=startupsItems.map(i=>i.id===id?{...i,[field]:field==="valueBRL"?parseFloat(val)||0:val}:i);setStartupsItems(n);persistManual("startups",n);}
      },[fidcItems,ativosReaisItems,startupsItems]);

      const addSchwabItem=useCallback(()=>{
        const {symbol,qty,classKey}=editingSchwab;
        if(!symbol||!qty||!classKey) return;
        const q=parseFloat(qty);
        if(isNaN(q)||q<=0) return;
        const item={id:symbol.toLowerCase(),label:symbol,symbol:symbol.toUpperCase(),qty:q,color:"#6366f1",classKey};
        const n=[...schwabItems,item];
        setSchwabItems(n);
        persistSchwab(n);
        setEditingSchwab({symbol:"",qty:"",classKey:""});
      },[editingSchwab,schwabItems]);

      const removeSchwabItem=useCallback((id)=>{
        const n=schwabItems.filter(i=>i.id!==id);
        setSchwabItems(n);
        persistSchwab(n);
      },[schwabItems]);

      const updateSchwabItem=useCallback((id,field,val)=>{
        const n=schwabItems.map(i=>i.id===id?{...i,[field]:field==="qty"?parseFloat(val)||0:val}:i);
        setSchwabItems(n);
        persistSchwab(n);
      },[schwabItems]);

      function buildDetailedByClass(){
        const result={};
        const latest=history[0];
        if(latest?.mappings){
          const rate=latest.usdRate||5.22;
          latest.mappings.forEach(m=>{
            if(m.ignore||!m.classKey) return;
            const brl=m.currency==="USD"?m.rawVal*rate:m.rawVal;
            if(!result[m.classKey]) result[m.classKey]=[];
            result[m.classKey].push({name:m.raw,valueBRL:brl,source:m.source||"manual",isPerm:false});
          });
        }
        calcCriptoPortfolio().forEach(p=>{
          if(p.valueBRL==null&&!p.isFallback) return;
          const vBRL=p.valueBRL||0;
          if(!result["cripto_ex"]) result["cripto_ex"]=[];
          result["cripto_ex"].push({name:`${p.label} (${p.symbol})`,valueBRL:vBRL,source:"perm",symbol:p.symbol,priceUSD:p.priceUSD,qty:p.qty,isPerm:true,isFallback:p.isFallback,color:p.color});
        });
        const bp=calcBrokerPortfolio();
        if(bp) bp.forEach(p=>{
          if(p.valueBRL==null) return;
          if(!result[p.classKey]) result[p.classKey]=[];
          result[p.classKey].push({name:`${p.label} (${p.symbol})`,valueBRL:p.valueBRL,source:"perm",symbol:p.symbol,priceUSD:p.priceUSD,qty:p.qty,isPerm:true,color:p.color});
        });
        [...fidcItems,...ativosReaisItems,...startupsItems].forEach(item=>{
          if(!item.classKey||item.valueBRL<=0) return;
          if(!result[item.classKey]) result[item.classKey]=[];
          result[item.classKey].push({name:item.name,valueBRL:item.valueBRL,source:"perm",isPerm:true,isManual:true});
        });
        return result;
      }

      function calc10k(){
        const al=mode==="target"?TARGET:customAlloc;const pat=parseFloat(patrimonio)||0;const newTotal=pat+10000;
        if(pat===0) return CLASSES.map(c=>({...c,gap:TARGET[c.key]-al[c.key]})).filter(c=>c.gap>0).sort((a,b)=>b.gap-a.gap).slice(0,3).map(c=>({label:c.label,color:c.color,gap:c.gap,amount:null}));
        const recs=[];let budget=10000;
        for(const c of [...CLASSES.map(c=>({...c,deficit:Math.max(0,(TARGET[c.key]/100)*newTotal-(al[c.key]/100)*pat)}))].filter(c=>c.deficit>0).sort((a,b)=>b.deficit-a.deficit)){
          if(budget<=0)break;const a=Math.min(c.deficit,budget);recs.push({label:c.label,color:c.color,amount:a,pct:(a/10000*100).toFixed(0)});budget-=a;
        }
        return recs;
      }

      const alloc=mode==="target"?TARGET:customAlloc;
      const total=Object.values(alloc).reduce((a,b)=>a+Number(b),0);
      const valid=Math.abs(total-100)<1;
      const groupTotals=GROUPS.reduce((acc,g)=>({...acc,[g]:CLASSES.filter(c=>c.group===g).reduce((s,c)=>s+Number(alloc[c.key]),0)}),{});
      const recs10k=calc10k();
      const learnedCount=Object.keys(customMap).length;
      const criptoPort=calcCriptoPortfolio();
      const brokerPort=calcBrokerPortfolio();
      const criptoTotalBRL=criptoPort.reduce((s,p)=>s+(p.valueBRL||0),0);
      const brokerTotalBRL=brokerPort?.reduce((s,p)=>s+(p.valueBRL||0),0)||0;
      const fidcTotal=fidcItems.reduce((s,i)=>s+i.valueBRL,0);
      const ativosTotal=ativosReaisItems.reduce((s,i)=>s+i.valueBRL,0);
      const startupsTotal=startupsItems.reduce((s,i)=>s+i.valueBRL,0);
      const permTotalBRL=criptoTotalBRL+brokerTotalBRL+fidcTotal+ativosTotal+startupsTotal;
      const criptoIsFallback=true;
      const latestImport=history[0];
      const detailedByClass=mode==="custom"?buildDetailedByClass():{};
      const pieData=CLASSES.filter(c=>alloc[c.key]>0.5).map(c=>({name:c.label,value:+alloc[c.key].toFixed(1),color:c.color,group:c.group}));

      // ─── STYLES ─────────────────────────────────────────────────────────────
      const S={
        page:  {fontFamily:"'Playfair Display','Georgia',serif",background:"#000",minHeight:"100vh",color:"#f8fafc",padding:"0"},
        hdr:   {background:"#000",borderBottom:"1px solid rgba(0,212,255,0.15)",padding:"48px 60px"},
        panel: {background:"#000",padding:"60px 80px",maxWidth:1400,margin:"0 auto"},
        card:  (c)=>({background:"rgba(0,0,0,0.4)",borderRadius:20,padding:"32px 36px",marginBottom:20,border:`1px solid ${c?`${c}25`:"rgba(148,163,184,0.1)"}`,boxShadow:c?`0 0 40px ${c}08`:"none",transition:"all 0.5s cubic-bezier(0.4, 0, 0.2, 1)"}),
        neonCard: (c)=>({background:"rgba(0,0,0,0.6)",borderRadius:24,padding:"28px 32px",border:`1px solid ${c}`,boxShadow:`0 0 60px ${c}20, 0 20px 60px rgba(0,0,0,0.4)`,transition:"all 0.4s ease"}),
        tab:   (on)=>({padding:"18px 32px",border:"none",cursor:"pointer",fontWeight:on?500:400,fontSize:12,letterSpacing:"1.5px",background:"transparent",color:on?"#00d4ff":"#64748b",borderBottom:on?"1px solid #00d4ff":"1px solid transparent",transition:"all 0.3s ease",fontFamily:"'Inter',-apple-system,sans-serif",textTransform:"uppercase"}),
        mode:  (on)=>({flex:1,padding:"20px 24px",borderRadius:16,border:on?"1px solid #00d4ff":"1px solid rgba(100,116,139,0.15)",cursor:"pointer",background:on?"rgba(0,212,255,0.04)":"transparent",color:on?"#00d4ff":"#94a3b8",fontWeight:on?600:400,fontSize:14,textAlign:"center",transition:"all 0.4s ease",fontFamily:"'Inter',sans-serif",boxShadow:on?"0 0 40px rgba(0,212,255,0.12)":"none"}),
        btn:   (ok,c="#00d4ff")=>({padding:"16px 32px",borderRadius:12,border:ok?`1px solid ${c}`:"1px solid rgba(30,41,59,0.5)",cursor:ok?"pointer":"not-allowed",background:ok?"transparent":"rgba(15,15,20,0.3)",color:ok?c:"#475569",fontWeight:600,fontSize:12,transition:"all 0.3s ease",fontFamily:"'Inter',sans-serif",letterSpacing:"1px",textTransform:"uppercase",boxShadow:ok?`0 0 30px ${c}15`:"none"}),
        inp:   {background:"rgba(0,0,0,0.6)",border:"1px solid rgba(100,116,139,0.2)",borderRadius:12,padding:"16px 20px",color:"#f8fafc",fontSize:14,transition:"all 0.3s ease",fontFamily:"'Inter',sans-serif",outline:"none"},
        sel:   {background:"rgba(0,0,0,0.6)",border:"1px solid rgba(100,116,139,0.2)",borderRadius:12,padding:"14px 18px",color:"#f8fafc",fontSize:13,cursor:"pointer",transition:"all 0.3s ease",fontFamily:"'Inter',sans-serif",outline:"none"},
      };

      const Badge=({text,color="#00d4ff"})=><span style={{fontSize:10,fontWeight:700,color,background:`${color}15`,border:`1px solid ${color}40`,padding:"4px 10px",letterSpacing:"1px",textTransform:"uppercase",fontFamily:"'Inter',sans-serif"}}>{text}</span>;

      const AssetRows=({classKey,classTotalBRL})=>{
        const items=detailedByClass[classKey];
        if(!items||items.length===0) return null;
        const isOpen=expandedClass[classKey];
        const cls=CLASSES.find(c=>c.key===classKey);
        return(
          <div style={{marginTop:16,borderTop:`1px solid ${cls?.color}20`,paddingTop:16}}>
            <button onClick={()=>setExpandedClass(p=>({...p,[classKey]:!p[classKey]}))} style={{background:"none",border:"none",cursor:"pointer",padding:0,fontSize:12,color:cls?.color,fontFamily:"'Inter',sans-serif",letterSpacing:"0.5px",textTransform:"uppercase",fontWeight:600}}>
              {isOpen?"▼":"▶"} {items.length} ATIVO{items.length>1?"S":""}
            </button>
            {isOpen&&(
              <div style={{marginTop:12,display:"flex",flexDirection:"column",gap:8}}>
                {items.sort((a,b)=>b.valueBRL-a.valueBRL).map((item,i)=>(
                  <div key={i} style={{background:"rgba(0,0,0,0.4)",border:`1px solid ${item.color||cls?.color}30`,padding:"14px 18px",display:"flex",alignItems:"center",gap:12,fontSize:13,fontFamily:"'Inter',sans-serif"}}>
                    <span style={{flex:1,color:"#cbd5e1",fontWeight:500}}>{item.name}</span>
                    {item.isFallback&&<Badge text="fallback" color="#f59e0b"/>}
                    {item.priceUSD&&<span style={{color:"#64748b",fontSize:11}}>@{fmtUSD(item.priceUSD)}</span>}
                    <span style={{fontWeight:700,color:item.color||cls?.color,fontSize:15}}>{fmt(item.valueBRL)}</span>
                    {!item.isPerm&&(
                      <select value={classKey} style={{...S.sel,fontSize:11,padding:"8px 12px"}} onChange={e=>reclassifyAsset(item.name,classKey,e.target.value)}>
                        {GROUPS.map(g=>(
                          <optgroup key={g} label={g}>
                            {CLASSES.filter(c=>c.group===g).map(c=><option key={c.key} value={c.key}>{c.label}</option>)}
                          </optgroup>
                        ))}
                      </select>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
        );
      };

      const PieTooltip=({active,payload})=>{
        if(!active||!payload?.length) return null;
        const d=payload[0].payload;
        return(
          <div style={{background:"rgba(0,0,0,0.95)",backdropFilter:"blur(10px)",border:`2px solid ${d.color}`,padding:"12px 16px",fontSize:13,boxShadow:`0 0 20px ${d.color}40`,fontFamily:"'Inter',sans-serif"}}>
            <div style={{fontWeight:700,marginBottom:4,color:d.color}}>{d.name}</div>
            <div style={{color:"#94a3b8"}}>{d.value}% · {d.group}</div>
          </div>
        );
      };

      const ManualItemForm=({type,title,items,total})=>(
        <div>
          <div style={{marginBottom:20}}>
            <h3 style={{margin:"0 0 8px",fontSize:24,fontWeight:400,color:"#f8fafc",fontFamily:"'Playfair Display',serif",letterSpacing:"1px"}}>{title}</h3>
            <p style={{margin:0,fontSize:14,color:"#64748b",fontFamily:"'Inter',sans-serif"}}>Total: <span style={{color:"#00d4ff",fontWeight:700}}>{fmt(total)}</span></p>
          </div>
          <div style={{background:"rgba(0,212,255,0.05)",border:"2px solid rgba(0,212,255,0.2)",borderRadius:16,padding:20,marginBottom:20}}>
            <div style={{display:"grid",gridTemplateColumns:"2fr 1fr 2fr auto",gap:12,alignItems:"end"}}>
              <div><label style={{fontSize:11,color:"#94a3b8",display:"block",marginBottom:8,fontFamily:"'Inter',sans-serif",letterSpacing:"1px",textTransform:"uppercase"}}>Nome</label>
                <input value={editingManual.type===type?editingManual.name:""} onChange={e=>setEditingManual({...editingManual,type,name:e.target.value})} placeholder="FIDC XYZ" style={{...S.inp,width:"100%"}}/>
              </div>
              <div><label style={{fontSize:11,color:"#94a3b8",display:"block",marginBottom:8,fontFamily:"'Inter',sans-serif",letterSpacing:"1px",textTransform:"uppercase"}}>Valor (R$)</label>
                <input value={editingManual.type===type?editingManual.valueBRL:""} onChange={e=>setEditingManual({...editingManual,type,valueBRL:e.target.value})} placeholder="10000" style={{...S.inp,width:"100%"}}/>
              </div>
              <div><label style={{fontSize:11,color:"#94a3b8",display:"block",marginBottom:8,fontFamily:"'Inter',sans-serif",letterSpacing:"1px",textTransform:"uppercase"}}>Classe</label>
                <select value={editingManual.type===type?editingManual.classKey:""} onChange={e=>setEditingManual({...editingManual,type,classKey:e.target.value})} style={{...S.sel,width:"100%"}}>
                  <option value="">Selecione</option>
                  {GROUPS.map(g=>(
                    <optgroup key={g} label={g}>
                      {CLASSES.filter(c=>c.group===g).map(c=><option key={c.key} value={c.key}>{c.label}</option>)}
                    </optgroup>
                  ))}
                </select>
              </div>
              <button onClick={()=>addManualItem(type)} style={{...S.btn(editingManual.type===type&&editingManual.name&&editingManual.valueBRL&&editingManual.classKey,"#00d4ff"),padding:"14px 20px"}}>Add</button>
            </div>
          </div>
          {items.length>0&&(
            <div style={{display:"flex",flexDirection:"column",gap:10}}>
              {items.map(item=>{
                const cls=CLASSES.find(c=>c.key===item.classKey);
                return(
                  <div key={item.id} style={{background:"rgba(0,0,0,0.4)",border:`1px solid ${cls?.color}30`,borderRadius:16,padding:"16px 20px",display:"flex",alignItems:"center",gap:14}}>
                    <input value={item.name} onChange={e=>updateManualItem(type,item.id,"name",e.target.value)} style={{...S.inp,flex:1,padding:"12px 16px"}}/>
                    <input value={item.valueBRL} onChange={e=>updateManualItem(type,item.id,"valueBRL",e.target.value)} style={{...S.inp,width:140,padding:"12px 16px"}}/>
                    <select value={item.classKey} onChange={e=>updateManualItem(type,item.id,"classKey",e.target.value)} style={{...S.sel,width:160}}>
                      {GROUPS.map(g=>(
                        <optgroup key={g} label={g}>
                          {CLASSES.filter(c=>c.group===g).map(c=><option key={c.key} value={c.key}>{c.label}</option>)}
                        </optgroup>
                      ))}
                    </select>
                    <Badge text={cls?.label||"—"} color={cls?.color}/>
                    <button onClick={()=>removeManualItem(type,item.id)} style={{background:"none",border:`2px solid #ef4444`,color:"#ef4444",cursor:"pointer",fontSize:14,padding:"10px 14px",borderRadius:10,fontWeight:700,transition:"all 0.3s ease",fontFamily:"'Inter',sans-serif"}}>✕</button>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      );

      return(
        <div style={S.page}>
          {/* HEADER */}
          <div style={S.hdr}>
            <div style={{maxWidth:1400,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
              <div>
                <h1 style={{margin:"0 0 16px",fontSize:56,fontWeight:400,color:"#f8fafc",fontFamily:"'Playfair Display',serif",letterSpacing:"3px",lineHeight:1.2}}>
                  Análise de<br/>Investimentos
                </h1>
                <p style={{margin:0,fontSize:13,color:"#64748b",fontFamily:"'Inter',sans-serif",letterSpacing:"2px",textTransform:"uppercase"}}>Guga · 37 anos · Moderado-Conservador</p>
              </div>
              <div style={{display:"flex",flexDirection:"column",gap:10,alignItems:"flex-end",marginTop:8}}>
                {learnedCount>0&&<Badge text={`${learnedCount} mapeamentos`} color="#00d4ff"/>}
                {history.length>0&&<Badge text={`${history.length} importações`} color="#10b981"/>}
                <div style={{fontSize:11,color:"#475569",fontFamily:"'Inter',sans-serif",letterSpacing:"1px"}}>Selic 15% · BTC = Ouro Digital</div>
              </div>
            </div>
          </div>

          <div style={{maxWidth:1400,margin:"0 auto"}}>
            <div style={{display:"flex",gap:0,marginBottom:48,borderBottom:"1px solid rgba(100,116,139,0.1)"}}>
              {[["carteira","Carteira"],["permanentes","Permanentes"]].map(([k,l])=>(
                <button key={k} onClick={()=>setTab(k)} style={S.tab(tab===k)}>{l}</button>
              ))}
            </div>

            <div style={S.panel}>

              {/* CARTEIRA */}
              {tab==="carteira"&&(
                <div>
                  <div style={{display:"flex",justifyContent:"space-between",marginBottom:32}}>
                    <div style={{display:"flex",gap:12}}>
                      <button onClick={()=>setMode("target")} style={S.mode(mode==="target")}>IDEAL</button>
                      <button onClick={()=>setMode("custom")} style={S.mode(mode==="custom")}>IMPORTADA</button>
                    </div>
                    <div style={{display:"flex",gap:12}}>
                      <button onClick={()=>setShowPie(!showPie)} style={S.btn(true,showPie?"#a855f7":"#00d4ff")}>{showPie?"Chart":"Pie"}</button>
                      {mode==="custom"&&<button onClick={saveCarteira} style={S.btn(true,"#10b981")}>{saveMsg||"Save"}</button>}
                    </div>
                  </div>

                  {mode==="custom"&&permTotalBRL>0&&(
                    <div style={{background:"rgba(16,185,129,0.1)",border:"2px solid rgba(16,185,129,0.3)",padding:"16px 24px",marginBottom:24,fontSize:14,color:"#10b981",fontFamily:"'Inter',sans-serif",boxShadow:"0 0 20px rgba(16,185,129,0.1)"}}>
                      Permanentes: {fmt(permTotalBRL)}
                      {criptoIsFallback&&<span style={{marginLeft:16,color:"#f59e0b"}}>· Cripto: fallback</span>}
                    </div>
                  )}

                  <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:24,marginBottom:48}}>
                    {GROUPS.map(g=><div key={g} style={{...S.neonCard(GROUP_COLORS[g]),textAlign:"center",cursor:"pointer",transform:"scale(1)",transition:"all 0.4s ease"}} onMouseEnter={e=>e.currentTarget.style.transform="scale(1.02)"} onMouseLeave={e=>e.currentTarget.style.transform="scale(1)"}><div style={{fontSize:11,color:"#94a3b8",fontFamily:"'Inter',sans-serif",letterSpacing:"2px",textTransform:"uppercase",marginBottom:12,fontWeight:500}}>{g}</div><div style={{fontSize:42,fontWeight:300,color:GROUP_COLORS[g],fontFamily:"'Playfair Display',serif",letterSpacing:"1px"}}>{groupTotals[g].toFixed(0)}<span style={{fontSize:24}}>%</span></div></div>)}
                    <div style={{...S.neonCard(valid?"#10b981":"#ef4444"),textAlign:"center",cursor:"pointer",transform:"scale(1)",transition:"all 0.4s ease"}} onMouseEnter={e=>e.currentTarget.style.transform="scale(1.02)"} onMouseLeave={e=>e.currentTarget.style.transform="scale(1)"}><div style={{fontSize:11,color:"#94a3b8",fontFamily:"'Inter',sans-serif",letterSpacing:"2px",textTransform:"uppercase",marginBottom:12,fontWeight:500}}>Total</div><div style={{fontSize:42,fontWeight:300,color:valid?"#10b981":"#ef4444",fontFamily:"'Playfair Display',serif",letterSpacing:"1px"}}>{total.toFixed(0)}<span style={{fontSize:24}}>%</span></div></div>
                  </div>

                  {showPie&&pieData.length>0&&(
                    <div style={{marginBottom:48,background:"rgba(0,0,0,0.4)",borderRadius:24,padding:40,border:"1px solid rgba(100,116,139,0.08)",boxShadow:"0 20px 60px rgba(0,0,0,0.4)"}}>
                      <ResponsiveContainer width="100%" height={320}>
                        <PieChart>
                          <Pie data={pieData} cx="50%" cy="50%" innerRadius={90} outerRadius={140} paddingAngle={3} dataKey="value" stroke="none">
                            {pieData.map((e,i)=><Cell key={i} fill={e.color}/>)}
                          </Pie>
                          <Tooltip content={<PieTooltip/>}/>
                        </PieChart>
                      </ResponsiveContainer>
                    </div>
                  )}

                  {GROUPS.map(g=>(
                    <div key={g} style={{marginBottom:40}}>
                      <div style={{display:"flex",alignItems:"center",gap:16,marginBottom:24}}>
                        <div style={{width:60,height:1,background:`linear-gradient(90deg, ${GROUP_COLORS[g]}, transparent)`}}/>
                        <h3 style={{margin:0,fontSize:28,fontWeight:400,color:"#f8fafc",fontFamily:"'Playfair Display',serif",letterSpacing:"2px"}}>{g}</h3>
                        <div style={{flex:1,height:1,background:`linear-gradient(90deg, ${GROUP_COLORS[g]}, transparent)`}}/>
                      </div>
                      <div style={{display:"flex",flexDirection:"column",gap:16}}>
                        {CLASSES.filter(c=>c.group===g&&(alloc[c.key]>0||mode==="target")).map(c=>{
                          const v=alloc[c.key];const diff=mode==="custom"?v-TARGET[c.key]:null;
                          const classBRL=latestImport?.brlValues?.[c.key]||0;
                          return(
                            <div key={c.key} style={{...S.card(c.color),cursor:"pointer",transform:"scale(1)"}} onMouseEnter={e=>e.currentTarget.style.transform="scale(1.01)"} onMouseLeave={e=>e.currentTarget.style.transform="scale(1)"}>
                              <div style={{display:"flex",alignItems:"center",gap:20}}>
                                <div style={{width:3,height:40,background:c.color,borderRadius:2}}/>
                                <span style={{fontSize:15,color:"#cbd5e1",flex:1,fontFamily:"'Inter',sans-serif",fontWeight:500,letterSpacing:"0.3px"}}>{c.label}</span>
                                {mode==="custom"&&classBRL>0&&<span style={{fontSize:13,color:"#64748b",fontFamily:"'Inter',sans-serif",fontWeight:400}}>{fmt(classBRL)}</span>}
                                <span style={{fontSize:28,fontWeight:300,color:c.color,fontFamily:"'Playfair Display',serif"}}>{pct(v)}</span>
                                {diff!==null&&Math.abs(diff)>0.1&&<span style={{fontSize:12,color:diff>0?"#10b981":"#ef4444",fontWeight:600,padding:"6px 14px",background:diff>0?"rgba(16,185,129,0.1)":"rgba(239,68,68,0.1)",borderRadius:8,fontFamily:"'Inter',sans-serif",border:`1px solid ${diff>0?"#10b98120":"#ef444420"}`}}>{diff>0?"▲":"▼"}{Math.abs(diff).toFixed(1)}pp</span>}
                              </div>
                              {mode==="custom"&&<AssetRows classKey={c.key} classTotalBRL={classBRL}/>}
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  ))}

                  <div style={{marginBottom:20}}>
                    <label style={{fontSize:12,color:"#94a3b8",display:"block",marginBottom:8,fontFamily:"'Inter',sans-serif",letterSpacing:"1px",textTransform:"uppercase"}}>Patrimônio (R$)</label>
                    <input value={patrimonio} onChange={e=>setPatrimonio(e.target.value)} placeholder="500000" style={{...S.inp,width:220}}/>
                  </div>

                  {recs10k.length>0&&(
                    <div style={{...S.card("#f59e0b"),marginBottom:20}}>
                      <h3 style={{margin:"0 0 16px",fontSize:18,fontWeight:600,color:"#f59e0b",fontFamily:"'Inter',sans-serif",letterSpacing:"1px",textTransform:"uppercase"}}>Próximos R$10.000</h3>
                      {recs10k.map((r,i)=>(
                        <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"12px 0",fontSize:15,borderBottom:i<recs10k.length-1?`1px solid ${r.color}20`:"none",fontFamily:"'Inter',sans-serif"}}>
                          <span style={{fontWeight:600,color:"#cbd5e1"}}>{i+1}. {r.label}</span>
                          <span style={{fontWeight:700,color:r.color}}>{r.amount?`${fmt(r.amount)} (${r.pct}%)`:`${r.gap.toFixed(1)}pp`}</span>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}

              {/* PERMANENTES */}
              {tab==="permanentes"&&(
                <div>
                  <div style={{marginBottom:40}}>
                    <h2 style={{margin:"0 0 12px",fontSize:42,fontWeight:300,color:"#f8fafc",fontFamily:"'Playfair Display',serif",letterSpacing:"3px"}}>Posições Permanentes</h2>
                    <p style={{margin:0,fontSize:14,color:"#64748b",fontFamily:"'Inter',sans-serif",letterSpacing:"0.5px"}}>Somadas automaticamente · Total: <span style={{color:"#00d4ff",fontWeight:600}}>{fmt(permTotalBRL)}</span></p>
                  </div>

                  <div style={{display:"flex",gap:0,borderBottom:"1px solid rgba(100,116,139,0.1)",marginBottom:32}}>
                    {[["cripto","Cripto"],["broker","Schwab"],["fidc","FIDC NPL"],["ativos","Ativos Reais"],["startups","Startups"]].map(([k,l])=>(
                      <button key={k} onClick={()=>setPermTab(k)} style={{...S.tab(permTab===k),padding:"16px 28px"}}>{l}</button>
                    ))}
                  </div>

                  {permTab==="cripto"&&(
                    <div>
                      <div style={{display:"flex",justifyContent:"space-between",marginBottom:20}}>
                        <div><span style={{fontSize:16,fontWeight:600,color:"#f8fafc",fontFamily:"'Inter',sans-serif"}}>Ledger Wallet</span>
                          <span style={{marginLeft:16,fontSize:14,color:"#f59e0b",fontFamily:"'Inter',sans-serif"}}>· Fallback</span>
                        </div>
                      </div>
                      <div style={{fontSize:16,fontWeight:700,marginBottom:16,color:"#f8fafc",fontFamily:"'Inter',sans-serif"}}>Total: <span style={{color:"#f59e0b"}}>{fmt(criptoTotalBRL)}</span></div>
                      <div style={{display:"flex",flexDirection:"column",gap:12}}>
                        {criptoPort.map(p=>(
                          <div key={p.id} style={{...S.card(p.color)}}>
                            <div style={{display:"flex",alignItems:"center",gap:14}}>
                              <span style={{flex:1,fontSize:15,fontWeight:600,color:"#cbd5e1",fontFamily:"'Inter',sans-serif"}}>{p.label}</span>
                              <Badge text="fallback" color="#f59e0b"/>
                              {p.priceUSD&&<span style={{fontSize:12,color:"#64748b",fontFamily:"'Inter',sans-serif"}}>@{fmtUSD(p.priceUSD)}</span>}
                              <span style={{fontWeight:700,fontSize:16,color:p.color,fontFamily:"'Playfair Display',serif"}}>{fmt(p.valueBRL)}</span>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {permTab==="broker"&&(
                    <div>
                      <div style={{marginBottom:20}}>
                        <h3 style={{margin:"0 0 8px",fontSize:24,fontWeight:400,color:"#f8fafc",fontFamily:"'Playfair Display',serif",letterSpacing:"1px"}}>Schwab Individual</h3>
                        <p style={{margin:0,fontSize:14,color:"#64748b",fontFamily:"'Inter',sans-serif"}}>Total: <span style={{color:"#a855f7",fontWeight:700}}>{fmt(brokerTotalBRL)}</span></p>
                      </div>

                      <div style={{background:"rgba(168,85,247,0.05)",border:"2px solid rgba(168,85,247,0.2)",borderRadius:16,padding:20,marginBottom:20}}>
                        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 2fr auto",gap:12,alignItems:"end"}}>
                          <div><label style={{fontSize:11,color:"#94a3b8",display:"block",marginBottom:8,fontFamily:"'Inter',sans-serif",letterSpacing:"1px",textTransform:"uppercase"}}>Ticker</label>
                            <input value={editingSchwab.symbol} onChange={e=>setEditingSchwab({...editingSchwab,symbol:e.target.value})} placeholder="AAPL" style={{...S.inp,width:"100%",textTransform:"uppercase"}}/>
                          </div>
                          <div><label style={{fontSize:11,color:"#94a3b8",display:"block",marginBottom:8,fontFamily:"'Inter',sans-serif",letterSpacing:"1px",textTransform:"uppercase"}}>Quantidade</label>
                            <input value={editingSchwab.qty} onChange={e=>setEditingSchwab({...editingSchwab,qty:e.target.value})} placeholder="100" style={{...S.inp,width:"100%"}}/>
                          </div>
                          <div><label style={{fontSize:11,color:"#94a3b8",display:"block",marginBottom:8,fontFamily:"'Inter',sans-serif",letterSpacing:"1px",textTransform:"uppercase"}}>Classe</label>
                            <select value={editingSchwab.classKey} onChange={e=>setEditingSchwab({...editingSchwab,classKey:e.target.value})} style={{...S.sel,width:"100%"}}>
                              <option value="">Selecione</option>
                              {GROUPS.map(g=>(
                                <optgroup key={g} label={g}>
                                  {CLASSES.filter(c=>c.group===g).map(c=><option key={c.key} value={c.key}>{c.label}</option>)}
                                </optgroup>
                              ))}
                            </select>
                          </div>
                          <button onClick={addSchwabItem} style={{...S.btn(editingSchwab.symbol&&editingSchwab.qty&&editingSchwab.classKey,"#a855f7"),padding:"14px 20px"}}>Add</button>
                        </div>
                      </div>

                      {schwabItems.length>0&&(
                        <div style={{display:"flex",flexDirection:"column",gap:10}}>
                          {schwabItems.map(item=>{
                            const cls=CLASSES.find(c=>c.key===item.classKey);
                            return(
                              <div key={item.id} style={{background:"rgba(0,0,0,0.4)",border:`1px solid ${cls?.color}30`,borderRadius:16,padding:"16px 20px",display:"flex",alignItems:"center",gap:14}}>
                                <span style={{fontSize:15,fontWeight:700,color:"#cbd5e1",fontFamily:"'Inter',sans-serif",width:80}}>{item.symbol}</span>
                                <input type="number" value={item.qty} onChange={e=>updateSchwabItem(item.id,"qty",e.target.value)} style={{...S.inp,width:100,padding:"12px 16px"}}/>
                                <select value={item.classKey} onChange={e=>updateSchwabItem(item.id,"classKey",e.target.value)} style={{...S.sel,width:200}}>
                                  {GROUPS.map(g=>(
                                    <optgroup key={g} label={g}>
                                      {CLASSES.filter(c=>c.group===g).map(c=><option key={c.key} value={c.key}>{c.label}</option>)}
                                    </optgroup>
                                  ))}
                                </select>
                                <Badge text={cls?.label||"—"} color={cls?.color}/>
                                <button onClick={()=>removeSchwabItem(item.id)} style={{background:"none",border:`2px solid #ef4444`,color:"#ef4444",cursor:"pointer",fontSize:14,padding:"10px 14px",borderRadius:10,fontWeight:700,transition:"all 0.3s ease",fontFamily:"'Inter',sans-serif",marginLeft:"auto"}}>✕</button>
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>
                  )}

                  {permTab==="fidc"&&<ManualItemForm type="fidc" title="FIDC NPL" items={fidcItems} total={fidcTotal}/>}
                  {permTab==="ativos"&&<ManualItemForm type="ativos" title="Ativos Reais" items={ativosReaisItems} total={ativosTotal}/>}
                  {permTab==="startups"&&<ManualItemForm type="startups" title="Startups" items={startupsItems} total={startupsTotal}/>}
                </div>
              )}

            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
